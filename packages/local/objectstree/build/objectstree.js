Ext.define("Objects.Trees",{extend:"Ext.tree.Panel",title:"Дерево объектов",xtype:"objectstree",layout:"fit",flex:1,rootVisible:false,useArrows:true,displayField:"name",bbar:[{xtype:"tbfill"},{xtype:"button",icon:"resources/images/ok-icon.png",iconCls:"background-size-contain",tooltip:"Выбрать все",name:"ckeckAllItemsBtn",align:"right",listeners:{click:function(c){var a=c.up("treepanel"),b=a.getRootNode().childNodes,d=a.getChecked();Ext.Object.each(d,function(e,g,f){g.set("checked",false)});Ext.Object.each(b,function(e,g,f){if(parseInt(g.data.id,10)!==-1){g.set("checked",true)}else{g.set("checked",false)}});a.collapseAll()}}},{xtype:"button",icon:"resources/images/cancel-icon.png",iconCls:"background-size-contain",tooltip:"Снять выделение",name:"unckeckAllItemsBtn",align:"right",listeners:{click:function(b){var a=b.up("treepanel"),c=a.getChecked();Ext.Object.each(c,function(d,f,e){f.set("checked",false)})}}},{xtype:"button",icon:"resources/images/showall-icon.png",iconCls:"background-size-contain",tooltip:"Развернуть",name:"expandAllItemsBtn",enableToggle:true,align:"right",listeners:{click:function(b){var a=b.up("treepanel");if(b.pressed){b.setTooltip("Свернуть");b.setIcon("resources/images/hiddenall-icon.png");a.setLoading("Загрузка...");a.expandAll(function(){a.setLoading(false)})}else{b.setTooltip("Развернуть");b.setIcon("resources/images/showall-icon.png");a.collapseAll()}}}}],listeners:{beforeitemexpand:function(c){var a=c,b=this;if(a.childNodes.length==1){a.removeAll();Ext.Ajax.request({url:"./data/main.php?type=MRTreeChilds",params:{id:a.data.id},success:function(d,e){var f=Ext.decode(d.responseText);for(key in f){a.appendChild(f[key])}}})}},checkchange:function(c,b,a){if(c.childNodes.length>1&&c.isExpanded()){c.cascadeBy(function(){this.set("checked",b)})}}}});